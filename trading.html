<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blox Fruit Trading</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Montserrat,sans-serif;background:#0f0f1a;color:#fff;min-height:100vh;display:flex;flex-direction:column}
a{text-decoration:none;color:inherit}
button{cursor:pointer}
.topbar{background:#11111a;border-bottom:1px solid #2a2a3a;padding:.5rem 1rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.logo{display:flex;align-items:center;gap:.5rem}
.logo img{width:40px;height:40px}
.game-switch{background:#00000066;border:1px solid #ffffff1a;border-radius:.75rem;padding:.5rem 1rem;color:#fff;font-weight:bold;display:flex;align-items:center;gap:.5rem}
.game-switch span{font-size:.875rem;color:#9ca3af}
.nav{flex:1;display:flex;justify-content:center;gap:1.5rem}
.nav a{color:#9ca3af;font-size:.875rem;transition:color .2s}
.nav a:hover{color:#fff}
.user-area{display:flex;gap:.5rem;align-items:center}
.user-area button{background:#0000001a;border:1px solid #ffffff0d;border-radius:.5rem;padding:.25rem .75rem;color:#d4d4ff;font-size:.75rem;transition:all .2s}
.user-area button:hover{background:#00000033;color:#e0e0ff}
#userInfo{display:flex;align-items:center;gap:.5rem;color:#fff;font-size:.875rem}
.avatar{width:32px;height:32px;border-radius:50%;overflow:hidden}
.avatar img{width:100%;height:100%;object-fit:cover}
.container{flex:1;max-width:1200px;margin:2rem auto;padding:0 1rem}
.trade-card{background:#11111a;border:1px solid #2a2a3a;border-radius:1rem;overflow:hidden;margin-bottom:1.5rem}
.trade-header{background:#11111a;padding:1rem;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #2a2a3a}
.user-info{display:flex;align-items:center;gap:.75rem}
.avatar{width:36px;height:36px;border-radius:50%;overflow:hidden}
.avatar img{width:100%;height:100%;object-fit:cover}
.username{font-weight:600;font-size:.875rem}
.time{font-size:.75rem;color:#9ca3af}
.trade-body{display:flex;flex-direction:column;gap:1rem;padding:1rem}
.offer,.request{flex:1}
.offer-title,.request-title{font-size:.875rem;font-weight:600;margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem}
.offer-title svg,.request-title svg{width:1rem;height:1rem}
.items{display:flex;gap:.75rem;flex-wrap:wrap}
.item{background:#11111a;border:1px solid #2a2a3a;border-radius:.75rem;width:110px;height:140px;display:flex;flex-direction:column;transition:transform .2s}
.item:hover{transform:translateY(-4px)}
.item-img{flex:1;padding:.5rem;display:flex;align-items:center;justify-content:center;position:relative}
.item-img img{max-width:100%;max-height:100%}
.item-value{background:#000000cc;border-top:1px solid #ffffff33;padding:.5rem;text-align:center;font-size:.75rem}
.arrow{display:flex;justify-content:center;align-items:center;font-size:1.5rem;color:#9ca3af}
.post-btn{background:#7c3aed;color:#fff;border:none;border-radius:.5rem;padding:.75rem 1.5rem;font-weight:600;margin:1rem auto;display:block}
.footer{background:#0f0f1a;border-top:1px solid #2a2a3a;padding:2rem 1rem;font-size:.875rem;color:#9ca3af}
.footer .inner{max-width:1200px;margin:auto;display:flex;flex-direction:column;gap:2rem}
.footer a:hover{color:#fff}
@media(min-width:640px){.trade-body{flex-direction:row;align-items:center}.offer,.request{flex:1}.arrow{margin:0 1rem}}
</style>
</head>
<body>
<div class="topbar">
<div class="logo"><a href="https://bloxfruittrading.com"><img src="https://bloxfruittrading.com/static/logo.gif" alt="logo"></a><div class="game-switch">Blox Fruits <span>Switch Game</span></div></div>
<nav class="nav"><a href="https://bloxfruittrading.com">Home</a><a href="https://dropjetic.github.io/bloxfruittradings/trading.html">Trade</a><a href="https://bloxfruittrading.com/values">Values</a><a href="https://bloxfruittrading.com/donators">Top Donators</a></nav>
<div class="user-area">
  <div id="userInfo"></div>
  <button id="loginBtn" style="display:none">Login with Roblox</button>
</div>
</div>
<div class="container">
<button class="post-btn" id="postBtn" style="display:none">Post Trade</button>
<div id="trades"></div>
</div>
<div class="footer">
<div class="inner">
<div><div style="display:flex;align-items:center;gap:.5rem;margin-bottom:1rem"><img src="https://bloxfruittrading.com/static/logo.png" width="36" height="36" alt="logo"><span style="background:linear-gradient(to right,#a78bfa,#ec4899);-webkit-background-clip:text;color:transparent;font-weight:800">Blox Fruit Trading</span></div><div>© 2025 Blox Fruit Trading All rights reserved.</div></div>
</div></div>

<script>
const ITEMS={"Kitsune":{"value":8000000,"img":"https://bloxfruittrading.com/static/items/kitsune.png"},"Dragon":{"value":6500000,"img":"https://bloxfruittrading.com/static/items/dragon.png"},"Leopard":{"value":5000000,"img":"https://bloxfruittrading.com/static/items/leopard.png"},"Venom":{"value":4500000,"img":"https://bloxfruittrading.com/static/items/venom.png"},"Dough":{"value":4200000,"img":"https://bloxfruittrading.com/static/items/dough.png"},"Shadow":{"value":4000000,"img":"https://bloxfruittrading.com/static/items/shadow.png"},"T-Rex":{"value":3800000,"img":"https://bloxfruittrading.com/static/items/t-rex.png"},"Mammoth":{"value":3500000,"img":"https://bloxfruittrading.com/static/items/mammoth.png"},"Control":{"value":3200000,"img":"https://bloxfruittrading.com/static/items/control.png"},"Spirit":{"value":3100000,"img":"https://bloxfruittrading.com/static/items/spirit.png"},"Blizzard":{"value":3000000,"img":"https://bloxfruittrading.com/static/items/blizzard.png"},"Gravity":{"value":2800000,"img":"https://bloxfruittrading.com/static/items/gravity.png"},"Magma":{"value":2700000,"img":"https://bloxfruittrading.com/static/items/magma.png"},"Rumble":{"value":2600000,"img":"https://bloxfruittrading.com/static/items/rumble.png"},"Phoenix":{"value":2500000,"img":"https://bloxfruittrading.com/static/items/phoenix.png"},"Buddha":{"value":2400000,"img":"https://bloxfruittrading.com/static/items/buddha.png"},"Dark":{"value":2300000,"img":"https://bloxfruittrading.com/static/items/dark.png"},"Light":{"value":2200000,"img":"https://bloxfruittrading.com/static/items/light.png"},"Ice":{"value":2100000,"img":"https://bloxfruittrading.com/static/items/ice.png"},"Flame":{"value":2000000,"img":"https://bloxfruittrading.com/static/items/flame.png"}};
const fmt=v=>((v/1000000).toFixed(v%1000000===0?0:1))+'M';
const renderTrade=t=>`<div class="trade-card"><div class="trade-header"><div class="user-info"><div class="avatar"><img src="${t.avatar}" alt="${t.user}"></div><div><div class="username">${t.user}</div><div class="time">just now</div></div></div></div><div class="trade-body"><div class="offer"><div class="offer-title">Offering</div><div class="items">${t.offer.map(i=>`<div class="item"><div class="item-img"><img src="${i.img}" alt="${i.name}"><span style="position:absolute;top:4px;left:4px;background:#7c3aed;color:#fff;padding:2px 6px;border-radius:4px;font-size:10px">R</span></div><div class="item-value"><span style="color:#fbbf24">${fmt(i.value)}</span></div></div>`).join('')}</div></div><div class="arrow">→</div><div class="request"><div class="request-title">Requesting</div><div class="items">${t.request.map(i=>`<div class="item"><div class="item-img"><img src="${i.img}" alt="${i.name}"></div><div class="item-value"><span style="color:#fbbf24">${fmt(i.value)}</span></div></div>`).join('')}</div></div></div></div>`;

async function checkLogin(){
  try{
    const r=await fetch('https://dropjetic.pythonanywhere.com/api/me',{credentials:'include'});
    if(r.ok){
      const u=await r.json();
      document.getElementById('userInfo').innerHTML=`<div class="avatar"><img src="${u.avatar}"></div><div>${u.username}</div><button onclick="logout()">Logout</button>`;
      document.getElementById('loginBtn').style.display='none';
      document.getElementById('postBtn').style.display='block';
    }else{
      document.getElementById('loginBtn').style.display='block';
      document.getElementById('postBtn').style.display='none';
      document.getElementById('userInfo').innerHTML='';
    }
  }catch{
    document.getElementById('loginBtn').style.display='block';
    document.getElementById('postBtn').style.display='none';
    document.getElementById('userInfo').innerHTML='';
  }
  loadTrades();
}

function logout(){
  fetch('https://dropjetic.pythonanywhere.com/auth/logout',{credentials:'include'}).then(()=>{location.reload()});
}

async function loadTrades(){
  try{
    const r=await fetch('https://dropjetic.pythonanywhere.com/api/trades',{credentials:'include'});
    if(r.ok){
      const d=await r.json();
      document.getElementById('trades').innerHTML=d.map(renderTrade).join('');
    }
  }catch{}
}

document.getElementById('loginBtn').onclick=()=>{location.href='https://dropjetic.pythonanywhere.com/auth/roblox';};

document.getElementById('postBtn').onclick=async ()=>{
  const r=await fetch('https://dropjetic.pythonanywhere.com/api/me',{credentials:'include'});
  if(!r.ok){
    location.href='https://dropjetic.pythonanywhere.com/auth/roblox';
    return;
  }
  const w=window.open('','_blank','width=600,height=700');
  w.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Post Trade</title><style>body{background:#0f0f1a;color:#fff;font-family:Montserrat,sans-serif;padding:2rem}.box{max-width:600px;margin:auto;background:#11111a;padding:2rem;border-radius:1rem;border:1px solid #2a2a3a}select{width:100%;padding:.5rem;margin:.5rem 0;background:#000;color:#fff;border:1px solid #2a2a3a;border-radius:.5rem}button{background:#7c3aed;color:#fff;padding:.75rem 1.5rem;border:none;border-radius:.5rem;margin-top:1rem;cursor:pointer}</style></head><body><div class="box"><h2>Post Trade</h2><form id="f"><h3>Offering</h3><div id="offer"></div><button type="button" onclick="add('offer')">+ Add</button><h3>Requesting</h3><div id="request"></div><button type="button" onclick="add('request')">+ Add</button><button type="submit">Post</button></form></div><script>const items=${JSON.stringify(Object.keys(ITEMS))};function add(s){const e=document.createElement('select');e.name=s;e.innerHTML='<option>--</option>'+items.map(i=>`<option value="${i}">${i}</option>`).join('');document.getElementById(s).appendChild(e)}document.getElementById('f').onsubmit=async e=>{e.preventDefault();const d=new FormData(e.target);const r=await fetch('https://dropjetic.pythonanywhere.com/api/post',{method:'POST',body:d,credentials:'include'});if(r.ok){alert('Posted!');setTimeout(()=>{window.close();opener.location.reload();},1000)}else{alert('Error')}}</script></body></html>`);
};

checkLogin();
setInterval(()=>{checkLogin();loadTrades();},30000);
</script>
</body>
</html>
