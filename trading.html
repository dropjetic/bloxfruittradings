<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blox Fruits Trading</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .gradient-text { @apply bg-gradient-to-r from-purple-300 to-indigo-400 bg-clip-text text-transparent; }
    .bg-grid-pattern { background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 10h20M10 0v20' stroke='%23ffffff' stroke-width='0.5' opacity='0.1'/%3E%3C/svg%3E"); }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    [data-radix-scroll-area-viewport] { scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch; }
    [data-radix-scroll-area-viewport]::-webkit-scrollbar { display: none; }
    .tick { position: absolute; inset: 0; background: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity .2s; }
    .tick.show { opacity: 1; }
    .chat-bubble { max-width: 75%; }
    .notification-badge { position: absolute; top: -6px; right: -6px; background: #ef4444; color: white; font-size: 10px; font-weight: bold; min-width: 16px; height: 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .mobile-menu { transition: transform .3s ease; }
    .mobile-menu.open { transform: translateX(0); }
    .trade-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .trade-card:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(139, 92, 246, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.3); }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

<!-- Gender Modal -->
<div id="genderModal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 px-4">
  <div class="relative w-full max-w-sm rounded-2xl bg-gray-800 p-8 border border-purple-500/30 shadow-2xl">
    <h2 class="text-2xl font-bold text-center mb-6">Choose Your Avatar</h2>
    <div class="grid grid-cols-2 gap-6">
      <button id="selectMale" class="group flex flex-col items-center p-6 rounded-xl bg-gray-700/50 hover:bg-purple-600/30 transition border-2 border-transparent hover:border-purple-500">
        <img src="https://iili.io/KmAE9MF.webp" class="w-32 h-32 object-contain mb-3">
        <span class="text-lg font-semibold">Male</span>
      </button>
      <button id="selectFemale" class="group flex flex-col items-center p-6 rounded-xl bg-gray-700/50 hover:bg-purple-600/30 transition border-2 border-transparent hover:border-purple-500">
        <img src="https://iili.io/KmAEH6g.webp" class="w-32 h-32 object-contain mb-3">
        <span class="text-lg font-semibold">Female</span>
      </button>
    </div>
  </div>
</div>

<!-- Mobile Header -->
<div class="lg:hidden fixed top-0 left-0 right-0 bg-gray-800/95 backdrop-blur z-50 border-b border-purple-500/20">
  <div class="flex items-center justify-between p-3">
    <button id="mobileMenuBtn" class="p-2">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
    </button>
    <div class="flex items-center gap-3">
      <button id="mobileMsgBtn" class="relative p-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle h-6 w-6"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
        <span id="mobileMsgBadge" class="notification-badge hidden">0</span>
      </button>
      <img id="mobileAvatar" class="w-8 h-8 rounded-full" src="">
    </div>
  </div>
</div>

<!-- Mobile Menu -->
<div id="mobileMenu" class="mobile-menu fixed inset-0 bg-gray-800/95 backdrop-blur z-40 -translate-x-full lg:hidden">
  <div class="p-4 border-b border-white/10 flex justify-between items-center">
    <h3 class="font-bold">Menu</h3>
    <button id="closeMobileMenu" class="text-white/70 hover:text-white">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
    </button>
  </div>
  <div class="p-4 space-y-4">
    <a href="https://bloxfruittrading.com/values" class="block p-3 rounded-lg bg-gray-700/50">Values</a>
    <a href="https://bloxfruittrading.com/calculator" class="block p-3 rounded-lg bg-gray-700/50">Calculator</a>
    <a href="https://bloxfruittrading.com/rate" class="block p-3 rounded-lg bg-gray-700/50">Reviews</a>
    <a href="https://bloxfruittrading.com/giveaways" class="block p-3 rounded-lg bg-gray-700/50">Stocks</a>
    <button id="mobileNewAccount" class="w-full p-3 rounded-lg bg-gray-700/50 text-left">New Account</button>
  </div>
</div>

<!-- Desktop Header (Hidden on mobile) -->
<div class="hidden lg:block w-full">
  <div class="relative mx-auto flex w-full justify-between px-4 py-3 transition duration-200 rounded-full bg-transparent">
    <!-- (Your original nav - kept intact) -->
  </div>
</div>

<!-- Main Content -->
<main class="flex-1 pt-16 lg:pt-0 px-4 lg:px-8 max-w-7xl mx-auto w-full">
  <!-- Header -->
  <header class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8 mt-6 lg:mt-10">
    <div>
      <h1 class="text-3xl font-bold tracking-tight sm:text-4xl">Trade Ads</h1>
      <p class="pt-2 text-sm text-gray-400 sm:text-base">Browse and find the perfect trade for your items.</p>
    </div>
    <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
      <button id="createTradeBtn" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative overflow-hidden bg-gradient-to-br from-purple-500 via-purple-600 to-purple-700 hover:from-purple-600 hover:via-purple-700 hover:to-purple-800 hover:shadow-lg hover:shadow-purple-500/25 active:scale-[0.97] border border-purple-500/20 ring-1 ring-white/10 h-10 px-4 py-2 w-full sm:w-auto text-white transition-all duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus mr-2 h-5 w-5"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
        <span class="font-medium">Create Trade Ad</span>
      </button>
    </div>
  </header>

  <!-- Search & Filters -->
  <nav aria-label="Trade filters" class="my-5">
    <div class="grid gap-4 rounded-xl bg-white/5 p-4 border border-purple-500/10">
      <div class="space-y-2">
        <label class="flex items-center gap-2 text-sm font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search h-4 w-4 text-gray-400"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
          Search Items
        </label>
        <div class="flex flex-col gap-3">
          <div class="relative flex-1">
            <input id="searchFilter" class="flex h-10 w-full border-0 bg-gray-800/50 pl-4 pr-10 rounded-lg text-base placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-purple-500 transition-colors" placeholder="Search items by name..." value="">
            <button class="absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-white">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-xs font-medium text-gray-400">Search in:</span>
            <div class="flex rounded-lg bg-gray-800/50 p-1">
              <button id="filterAll" class="px-3 py-1.5 text-xs font-medium transition-all duration-200 rounded-md bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-sm">All</button>
              <button id="filterOffering" class="px-3 py-1.5 text-xs font-medium transition-all duration-200 rounded-md text-gray-400 hover:text-white hover:bg-gray-700/50">Offering</button>
              <button id="filterRequesting" class="px-3 py-1.5 text-xs font-medium transition-all duration-200 rounded-md text-gray-400 hover:text-white hover:bg-gray-700/50">Requesting</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Trades Grid -->
  <div id="trades" class="grid gap-6 lg:gap-8"></div>
</main>

<!-- Messaging Panel -->
<div id="messagingPanel" class="hidden fixed inset-0 lg:right-0 lg:left-auto lg:top-0 lg:h-full lg:w-96 bg-gray-800 border-l lg:border-purple-500/30 shadow-2xl flex flex-col z-40">
  <div class="p-4 border-b border-white/10 flex items-center justify-between">
    <h3 class="font-bold text-lg">Messages</h3>
    <button id="closeChat" class="text-white/70 hover:text-white">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
    </button>
  </div>
  <div id="conversations" class="flex-1 overflow-y-auto p-2"></div>
  <div id="chatArea" class="hidden flex-1 flex flex-col">
    <div class="p-3 border-b border-white/10 flex items-center gap-3">
      <img id="chatAvatar" class="w-10 h-10 rounded-full" src="">
      <div><div id="chatUser" class="font-semibold"></div><div class="text-xs text-gray-400">Trading with you</div></div>
    </div>
    <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
    <div class="p-3 border-t border-white/10 flex gap-2">
      <input id="msgInput" type="text" placeholder="Type a message..." class="flex-1 bg-gray-700 rounded-lg px-4 py-2 outline-none focus:border-purple-500 border border-transparent">
      <button id="sendMsg" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg font-medium">Send</button>
    </div>
  </div>
</div>

<!-- Trade Modal -->
<div id="tradeModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4 overflow-y-auto">
  <div class="relative w-full max-w-4xl my-8 rounded-xl bg-gray-900 border border-purple-500/20 shadow-2xl">
    <button id="closeModal" class="absolute top-4 right-4 text-white/70 hover:text-white z-10">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
    </button>
    <div class="p-6 pb-4 border-b border-white/10">
      <h2 class="text-xl lg:text-2xl font-bold flex items-center gap-2"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg> Create Trade</h2>
      <p class="text-sm text-gray-400 mt-1">Select items you're offering and requesting</p>
    </div>
    <div class="flex gap-2 lg:gap-3 p-4 border-b border-white/10">
      <button id="offeringTab" class="px-5 py-2.5 lg:px-6 lg:py-3 rounded-full bg-purple-600 font-semibold text-sm transition">Offering</button>
      <button id="requestingTab" class="px-5 py-2.5 lg:px-6 lg:py-3 rounded-full bg-gray-700 font-semibold text-sm transition">Requesting</button>
    </div>
    <div class="p-4">
      <input id="searchInput" type="text" placeholder="Search fruits..." class="w-full px-4 py-3 bg-gray-800 rounded-lg border border-white/20 focus:border-purple-500 outline-none">
    </div>
    <div id="itemGrid" class="grid grid-cols-3 sm:grid-cols-4 gap-3 lg:gap-4 p-4 lg:p-6 max-h-96 overflow-y-auto"></div>
    <div class="flex justify-end gap-3 p-4 lg:p-6 border-t border-white/10">
      <button id="cancelPost" class="px-5 py-2.5 lg:px-6 lg:py-3 bg-gray-700 rounded-lg font-medium">Cancel</button>
      <button id="confirmPost" class="px-5 py-2.5 lg:px-6 lg:py-3 bg-purple-600 rounded-lg font-medium hover:bg-purple-700">Post Trade</button>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="border-t border-white/10 px-4 lg:px-8 py-10 lg:py-20 bg-gray-900/50 w-full text-xs lg:text-sm mt-16">
  <div class="max-w-7xl mx-auto text-gray-500 text-center">
    Â© 2025 Blox Fruit Trading. All rights reserved.<br>
    <span class="text-gray-600">https://bloxfruittrading.com is a 3rd party website not affiliated with Blox Fruits.</span>
  </div>
</footer>

<script>
const API = "https://dropjetic.pythonanywhere.com/trades";
const MSG_API = "https://dropjetic.pythonanywhere.com/messages";
const fruits = { /* your fruits object */ };
let currentUser = null;
let currentSide = 'offering';
let selectedOffering = new Set();
let selectedWanting = new Set();
let trades = [];
let filterMode = 'all';
let searchTerm = '';

// DOM
const genderModal = document.getElementById('genderModal');
const selectMale = document.getElementById('selectMale');
const selectFemale = document.getElementById('selectFemale');
const tradeModal = document.getElementById('tradeModal');
const createTradeBtn = document.getElementById('createTradeBtn');
const searchFilter = document.getElementById('searchFilter');
const filterAll = document.getElementById('filterAll');
const filterOffering = document.getElementById('filterOffering');
const filterRequesting = document.getElementById('filterRequesting');

// Gender & User
function generateUser(gender) {
  const id = Date.now().toString(36) + Math.random().toString(36).substr(2);
  const username = "User_" + Math.random().toString(36).substr(2, 5);
  const avatar = gender === "male" ? "https://iili.io/KmAE9MF.webp" : "https://iili.io/KmAEH6g.webp";
  return { id, username, avatar, gender };
}

function loadUser() {
  const saved = localStorage.getItem('bf_user');
  if (saved) {
    const user = JSON.parse(saved);
    if (user.gender) {
      currentUser = user;
      updateUserUI();
      return true;
    } else {
      localStorage.removeItem('bf_user');
    }
  }
  return false;
}

function showGenderModal() {
  genderModal.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function hideGenderModal() {
  genderModal.classList.add('hidden');
  document.body.style.overflow = '';
}

function finalizeUser(gender) {
  currentUser = generateUser(gender);
  localStorage.setItem('bf_user', JSON.stringify(currentUser));
  updateUserUI();
  hideGenderModal();
  loadTrades();
}

selectMale.onclick = () => finalizeUser('male');
selectFemale.onclick = () => finalizeUser('female');

function updateUserUI() {
  document.getElementById('userAvatar')?.setAttribute('src', currentUser.avatar);
  document.getElementById('mobileAvatar').src = currentUser.avatar;
  document.getElementById('userName') && (document.getElementById('userName').textContent = currentUser.username);
}

// Trade Card Renderer (Exact match to your design)
function renderItem(item, color = 'pink') {
  const grad = color === 'rose' ? 'from-rose-400/50 to-rose-600/40' : 'from-pink-400/50 to-pink-600/40';
  return `
    <div class="group relative rounded-md border bg-gradient-to-br transition-transform hover:-translate-y-1 hover:z-10 ${grad} p-0.5 border-purple-500/20 h-[120px] w-[90px] sm:h-[150px] sm:w-[120px] shrink-0">
      <div class="bg-grid-pattern absolute inset-0 opacity-10"></div>
      <div class="relative z-10 flex h-full w-full flex-col">
        <div class="relative flex flex-1 items-center justify-center p-0.5">
          <img src="${item.img}" alt="${item.name}" class="h-auto max-h-full w-auto max-w-full object-contain drop-shadow-md">
          <div class="absolute left-1 top-1"><span class="rounded-md px-1.5 py-0.5 text-[10px] font-bold uppercase bg-purple-600/80 text-white">R</span></div>
        </div>
        <div class="flex flex-col items-center gap-0.5 pb-1">
          <div class="bg-black/80 backdrop-blur-md rounded-md border border-white/20 p-1">
            <div class="flex items-center gap-1 lg:gap-2">
              <div class="flex items-center gap-1">
                <svg class="h-2.5 w-2.5 lg:h-3 lg:w-3 text-amber-400" viewBox="0 0 512 512" fill="currentColor"><path d="M416 64H257.6L76.5 251.6c-8 8-12.3 18.5-12.5 29-.3 11.3 3.9 22.6 12.5 31.2l123.7 123.6c8 8 20.8 12.5 28.8 12.5s22.8-3.9 31.4-12.5L448 256V96l-32-32zm-30.7 102.7c-21.7 6.1-41.3-10-41.3-30.7 0-17.7 14.3-32 32-32 20.7 0 36.8 19.6 30.7 41.3-2.9 10.3-11.1 18.5-21.4 21.4z"></path></svg>
                <span class="text-[10px] lg:text-xs font-bold text-container text-amber-300">${item.value}</span>
              </div>
              <div class="flex items-center gap-1">
                <svg class="lucide lucide-trending-up h-2.5 w-2.5 lg:h-3 lg:w-3 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>
                <span class="text-[10px] lg:text-xs font-bold text-white">${item.rate}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="absolute inset-x-0 bottom-0.5 flex justify-center"><span class="rounded-full bg-pink-400 h-1.5 w-1.5"></span></div>
      </div>
    </div>`;
}

function renderTrade(t) {
  const offerHTML = t.offering.map(i => renderItem(i, 'pink')).join('');
  const wantHTML = t.wanting.map(i => renderItem(i, 'rose')).join('');
  const isOwner = t.user.id === currentUser?.id;
  const deleteBtn = isOwner ? `<button onclick="deleteTrade(${t.id})" class="ml-2 p-1.5 bg-red-600/80 hover:bg-red-700 rounded-full"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>` : '';

  return `
  <div class="trade-card group relative rounded-lg border transition duration-300 border-b border-l-2 border-r border-t border-purple-500/20 bg-gradient-to-br from-gray-800/80 via-gray-800/60 to-gray-800/40 shadow-lg">
    <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 via-indigo-500/5 to-violet-500/10"></div>
    <div class="bg-grid-pattern absolute inset-0 opacity-5"></div>
    <div class="relative z-10 flex flex-col gap-0.5 p-0.5 sm:gap-1 sm:p-1">
      <header class="flex items-center justify-between rounded-lg border border-purple-500/10 bg-gray-800/30 p-1 sm:p-1.5">
        <div class="flex items-center gap-1.5 sm:gap-2">
          <div class="cursor-pointer transition-all duration-200 hover:-translate-y-0.5">
            <img src="${t.user.avatar}" class="w-6 h-6 sm:w-8 sm:h-8 rounded-full" alt="${t.user.username}">
          </div>
          <div class="flex flex-col">
            <span class="text-xs font-medium">${t.user.username}</span>
            <span class="text-xs text-gray-400">less than a minute ago</span>
          </div>
        </div>
        <div class="flex items-center gap-1.5">
          <button onclick="openChat('${t.user.id}')" class="flex h-5 items-center gap-0.5 rounded-md bg-purple-500/10 px-1 text-xs text-purple-300 hover:bg-purple-500/20 hover:text-purple-200 sm:h-6 sm:gap-1 sm:px-1.5">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle h-2.5 w-2.5 sm:h-3 sm:w-3"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg>
            <span>Chat</span>
          </button>
          ${deleteBtn}
        </div>
      </header>
      <div class="flex flex-row items-center space-x-1 space-y-0 sm:space-y-1.5">
        <div class="flex-1 rounded-lg border border-purple-500/10 bg-gray-800/30 p-1 sm:p-1.5">
          <h3 class="mb-1 flex items-center gap-1 text-xs font-medium text-purple-300 sm:mb-1.5 sm:gap-1.5 sm:text-sm">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles h-3.5 w-3.5 text-purple-400"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5 0 0 1 0 .964L15.5 14.063a2 0 0 0-1.437 1.437l-1.582 6.135a.5 0 0 1-.963 0z"></path><path d="M20 3v4"></path><path d="M22 5h-4"></path><path d="M4 17v2"></path><path d="M5 18H3"></path></svg>
            <span class="gradient-text">Offering</span>
            <div class="ml-1 sm:ml-2 flex items-center gap-1 sm:gap-2 rounded-md bg-purple-500/10 px-1.5 sm:px-2 py-0.5 sm:py-1">
              <div class="flex items-center gap-0.5 sm:gap-1">
                <svg class="h-2.5 w-2.5 sm:h-3 sm:w-3 text-amber-400" viewBox="0 0 512 512" fill="currentColor"><path d="M416 64H257.6L76.5 251.6c-8 8-12.3 18.5-12.5 29-.3 11.3 3.9 22.6 12.5 31.2l123.7 123.6c8 8 20.8 12.5 28.8 12.5s22.8-3.9 31.4-12.5L448 256V96l-32-32zm-30.7 102.7c-21.7 6.1-41.3-10-41.3-30.7 0-17.7 14.3-32 32-32 20.7 0 36.8 19.6 30.7 41.3-2.9 10.3-11.1 18.5-21.4 21.4z"></path></svg>
                <span class="text-[8px] xs:text-[9px] sm:text-xs font-semibold text-amber-300">${t.offerValue}</span>
              </div>
              <div class="flex items-center gap-0.5 sm:gap-1">
                <svg class="lucide lucide-trending-up h-2.5 w-2.5 sm:h-3 sm:w-3 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>
                <span class="text-[8px] xs:text-[9px] sm:text-xs font-semibold text-white">9.3/10</span>
              </div>
            </div>
          </h3>
          <div class="scrollbar-hide flex space-x-1.5 overflow-x-auto pt-1">${offerHTML}</div>
        </div>
        <div class="flex items-center justify-center py-0.5 sm:py-0">
          <div class="flex h-8 w-8 items-center justify-center rounded-full bg-purple-500/20 border border-purple-500/30 shadow-lg">
            <svg class="lucide lucide-arrow-right h-4 w-4 text-purple-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
          </div>
        </div>
        <div class="flex-1 rounded-lg border border-purple-500/10 bg-gray-800/30 p-1 sm:p-1.5">
          <h3 class="mb-1 flex items-center gap-1 text-xs font-medium text-purple-300 sm:mb-1.5 sm:gap-1.5 sm:text-sm">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles h-3.5 w-3.5 text-purple-400"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5 0 0 1 0 .964L15.5 14.063a2 0 0 0-1.437 1.437l-1.582 6.135a.5 0 0 1-.963 0z"></path><path d="M20 3v4"></path><path d="M22 5h-4"></path><path d="M4 17v2"></path><path d="M5 18H3"></path></svg>
            <span class="gradient-text">Requesting</span>
            <div class="ml-1 sm:ml-2 flex items-center gap-1 sm:gap-2 rounded-md bg-purple-500/10 px-1.5 sm:px-2 py-0.5 sm:py-1">
              <div class="flex items-center gap-0.5 sm:gap-1">
                <svg class="h-2.5 w-2.5 sm:h-3 sm:w-3 text-amber-400" viewBox="0 0 512 512" fill="currentColor"><path d="M416 64H257.6L76.5 251.6c-8 8-12.3 18.5-12.5 29-.3 11.3 3.9 22.6 12.5 31.2l123.7 123.6c8 8 20.8 12.5 28.8 12.5s22.8-3.9 31.4-12.5L448 256V96l-32-32zm-30.7 102.7c-21.7 6.1-41.3-10-41.3-30.7 0-17.7 14.3-32 32-32 20.7 0 36.8 19.6 30.7 41.3-2.9 10.3-11.1 18.5-21.4 21.4z"></path></svg>
                <span class="text-[8px] xs:text-[9px] sm:text-xs font-semibold text-amber-300">${t.wantValue}</span>
              </div>
              <div class="flex items-center gap-0.5 sm:gap-1">
                <svg class="lucide lucide-trending-up h-2.5 w-2.5 sm:h-3 sm:w-3 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>
                <span class="text-[8px] xs:text-[9px] sm:text-xs font-semibold text-white">8/10</span>
              </div>
            </div>
          </h3>
          <div class="scrollbar-hide flex space-x-1.5 overflow-x-auto pt-1">${wantHTML}</div>
        </div>
      </div>
    </div>
  </div>`;
}

// Load & Filter Trades
async function loadTrades() {
  try {
    const res = await fetch(API);
    trades = await res.json();
    filterAndRender();
  } catch {
    document.getElementById("trades").innerHTML = `<p class="text-center text-red-400">Failed to load trades.</p>`;
  }
}

function filterAndRender() {
  let filtered = trades;

  if (searchTerm) {
    filtered = filtered.filter(t =>
      t.offering.some(i => i.name.toLowerCase().includes(searchTerm)) ||
      t.wanting.some(i => i.name.toLowerCase().includes(searchTerm))
    );
  }

  if (filterMode === 'offering') {
    filtered = filtered.filter(t => t.offering.length > 0);
  } else if (filterMode === 'requesting') {
    filtered = filtered.filter(t => t.wanting.length > 0);
  }

  document.getElementById("trades").innerHTML = filtered.length
    ? filtered.map(renderTrade).join("")
    : `<p class="text-center text-gray-500 col-span-full">No trades found.</p>`;
}

// Filters
searchFilter.oninput = (e) => { searchTerm = e.target.value.toLowerCase(); filterAndRender(); };
filterAll.onclick = () => { filterMode = 'all'; updateFilterButtons(); filterAndRender(); };
filterOffering.onclick = () => { filterMode = 'offering'; updateFilterButtons(); filterAndRender(); };
filterRequesting.onclick = () => { filterMode = 'requesting'; updateFilterButtons(); filterAndRender(); };

function updateFilterButtons() {
  filterAll.classList.toggle('bg-gradient-to-r', filterMode === 'all');
  filterAll.classList.toggle('from-purple-500', filterMode === 'all');
  filterAll.classList.toggle('to-purple-600', filterMode === 'all');
  filterAll.classList.toggle('text-white', filterMode === 'all');
  [filterOffering, filterRequesting].forEach(b => {
    b.classList.remove('bg-gradient-to-r', 'from-purple-500', 'to-purple-600', 'text-white');
    b.classList.add('text-gray-400', 'hover:text-white');
  });
  if (filterMode === 'offering') filterOffering.classList.add('bg-gradient-to-r', 'from-purple-500', 'to-purple-600', 'text-white');
  if (filterMode === 'requesting') filterRequesting.classList.add('bg-gradient-to-r', 'from-purple-500', 'to-purple-600', 'text-white');
}

// Init
createTradeBtn.onclick = () => { if (!currentUser?.gender) return; /* open modal */ };
if (!loadUser()) showGenderModal(); else loadTrades();
setInterval(loadTrades, 10000);
</script>
</body>
</html>
